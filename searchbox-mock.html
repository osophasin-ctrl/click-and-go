<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Click & Go – Mock Search Box</title>
  <meta name="description" content="Prototype mock search box (no outbound link)" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style.css" />

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_green.css">

  <style>
    /* ===== Overrides เฉพาะหน้านี้ เพื่อจัด 4 บรรทัด ===== */
    .mock-box.stack { padding: 20px; }
    .mock-title { font-size: clamp(22px, 3vw, 32px); font-weight: 800; margin: 0 0 6px; color:#222; }
    .mock-sub   { margin: 0 0 14px; color:#6b7280; }

    .stack .mock-row { display: grid; gap: 10px; grid-template-columns: 1fr; }
    .stack .mock-row.dates { grid-template-columns: 1fr 1fr; }
    .stack .mock-row.guests { grid-template-columns: 1fr; }
    .stack .mock-row.submit .mock-btn { width: 100%; height: 52px; border-radius: 12px; font-size: 18px; }

    .mock-input, .guest-input {
      height: 48px;
      border: 1px solid #d7d7d7;
      border-radius: 10px;
      padding: 0 14px;
      background: #fff;
      font-size: 16px;
    }

    /* flatpickr alt input ให้หน้าตากลมกลืน */
    .flatpickr-input[readonly] { background:#fff; }

    /* suggestion panel */
    .suggest-wrap { position: relative; }
    .suggest-panel {
      position: absolute; left: 0; right: 0; top: calc(100% + 6px);
      background: #fff; border: 1px solid #e5e7eb; border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.08);
      max-height: 260px; overflow: auto; z-index: 999;
    }
    .suggest-item { display:flex; justify-content:space-between; align-items:center; padding:12px 14px; cursor:pointer; }
    .suggest-item:hover { background:#f5f7f8; }
    .suggest-item .sub { color:#666; font-size:12px; }
    .suggest-empty { padding:12px 14px; color:#777; }

    /* responsive ปรับให้สวยในมือถือ */
    @media (max-width: 560px){
      .stack .mock-row.dates { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="inner">
      <a href="/" class="brand"><img src="/logo.png" alt="GO" width="40" height="40"><span class="brand-text">Click & Go</span></a>
      <nav class="main-nav">
        <span style="font-weight:700">Click & Go – Mock Search Box</span>
        <span style="color:#999">Prototype (no outbound link)</span>
      </nav>
    </div>
  </header>

  <main class="container" style="margin-top:12px">
    <section class="widget-like solid agoda-wrap">
      <div class="mock-box stack">
        <h1 class="mock-title">Find the best deals</h1>
        <p class="mock-sub">Type a city or hotel name, pick your dates, select guests and search.</p>

        <form id="mockForm" autocomplete="off">
          <!-- Row 1 : Destination -->
          <div class="mock-row dest">
            <div class="suggest-wrap">
              <input id="destination" class="mock-input" type="text"
                     placeholder="Destination e.g., Bangkok or hotel name" aria-label="Destination"
                     autocomplete="off" />
              <div id="suggestPanel" class="suggest-panel" hidden></div>
            </div>
          </div>

          <!-- Row 2 : Dates -->
          <div class="mock-row dates" style="margin-top:4px;">
            <input id="checkin"  class="mock-input date" type="text" placeholder="Check-in"  readonly>
            <input id="checkout" class="mock-input date" type="text" placeholder="Check-out" readonly>
          </div>

          <!-- Row 3 : Guests -->
          <div class="mock-row guests" style="margin-top:4px;">
            <button type="button" id="guestBtn" class="guest-input" aria-haspopup="dialog" aria-controls="guestModal">
              1 Room, 2 Adults, 0 Children
            </button>
          </div>

          <!-- Row 4 : Search -->
          <div class="mock-row submit" style="margin-top:4px;">
            <button type="submit" class="mock-btn">Search</button>
          </div>

          <!-- hidden -->
          <input type="hidden" id="rooms" value="1">
          <input type="hidden" id="adults" value="2">
          <input type="hidden" id="children" value="0">
        </form>
      </div>
    </section>
  </main>

  <!-- Guest Modal -->
  <div id="guestBackdrop" class="modal-backdrop" aria-hidden="true"></div>
  <div id="guestModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="guestTitle">
    <div class="modal-header">
      <div id="guestTitle" class="modal-title">Travelers</div>
      <button type="button" class="btn-outline" id="btnCloseX">×</button>
    </div>
    <div class="modal-body">
      <div class="row-ctrl">
        <div class="label-wrap">
          <strong>Rooms</strong><small>Number of rooms</small>
        </div>
        <div class="counter">
          <button class="btn-ctrl" data-type="rooms" data-op="minus">−</button>
          <span class="count" id="roomsCount">1</span>
          <button class="btn-ctrl" data-type="rooms" data-op="plus">+</button>
        </div>
      </div>
      <div class="row-ctrl">
        <div class="label-wrap">
          <strong>Adults</strong><small>Ages 18+</small>
        </div>
        <div class="counter">
          <button class="btn-ctrl" data-type="adults" data-op="minus">−</button>
          <span class="count" id="adultsCount">2</span>
          <button class="btn-ctrl" data-type="adults" data-op="plus">+</button>
        </div>
      </div>
      <div class="row-ctrl">
        <div class="label-wrap">
          <strong>Children</strong><small>Ages 0–17</small>
        </div>
        <div class="counter">
          <button class="btn-ctrl" data-type="children" data-op="minus">−</button>
          <span class="count" id="childrenCount">0</span>
          <button class="btn-ctrl" data-type="children" data-op="plus">+</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-outline" id="btnCancel">Cancel</button>
      <button class="btn-primary" id="btnSaveGuests">Save</button>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container" style="text-align:center">
      <div class="footer-links">
        <a href="/privacy.html">Privacy</a> ·
        <a href="/terms.html">Terms</a> ·
        <a href="/about.html">About</a>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // --- Flatpickr (date pickers) ---
    (function(){
      const ONE_DAY = 24*60*60*1000;
      const inPicker = flatpickr("#checkin", {
        dateFormat: "Y-m-d",
        altInput: true,
        altFormat: "d M Y",
        minDate: "today",
        onChange(dates){
          if(dates[0]){
            const next = new Date(dates[0].getTime()+ONE_DAY);
            outPicker.set('minDate', next);
            if(!outPicker.selectedDates[0] || outPicker.selectedDates[0] <= dates[0]){
              outPicker.setDate(next, true);
            }
          }
        }
      });
      const outPicker = flatpickr("#checkout", {
        dateFormat: "Y-m-d",
        altInput: true,
        altFormat: "d M Y",
        minDate: new Date(Date.now()+ONE_DAY)
      });
      const today = new Date();
      const tomorrow = new Date(Date.now()+ONE_DAY);
      inPicker.setDate(today, true);
      outPicker.setDate(tomorrow, true);

      // --- Guests popup logic ---
      let rooms = 1, adults = 2, children = 0;
      const guestBtn = document.getElementById('guestBtn');
      const roomsCount = document.getElementById('roomsCount');
      const adultsCount = document.getElementById('adultsCount');
      const childrenCount = document.getElementById('childrenCount');
      const hiddenRooms = document.getElementById('rooms');
      const hiddenAdults = document.getElementById('adults');
      const hiddenChildren = document.getElementById('children');
      const modal = document.getElementById('guestModal');
      const backdrop = document.getElementById('guestBackdrop');

      function updateGuestBtn(){
        guestBtn.textContent = `${rooms} Room${rooms>1?'s':''}, ${adults} Adult${adults>1?'s':''}, ${children} Child${children>1?'ren':''}`;
      }
      updateGuestBtn();

      function openModal(){ roomsCount.textContent=rooms; adultsCount.textContent=adults; childrenCount.textContent=children; modal.style.display='block'; backdrop.style.display='block'; }
      function closeModal(){ modal.style.display='none'; backdrop.style.display='none'; }
      guestBtn.addEventListener('click', openModal);
      document.getElementById('btnCloseX').addEventListener('click', closeModal);
      document.getElementById('btnCancel').addEventListener('click', closeModal);
      backdrop.addEventListener('click', closeModal);

      document.querySelectorAll('.btn-ctrl').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const type = btn.getAttribute('data-type'), op = btn.getAttribute('data-op');
          let min=0, val=0, max=10;
          if(type==='rooms'){ val=rooms; min=1; }
          if(type==='adults'){ val=adults; min=1; }
          if(type==='children'){ val=children; min=0; }
          if(op==='plus' && val<max) val++;
          if(op==='minus' && val>min) val--;
          if(type==='rooms'){ rooms=val; roomsCount.textContent=val; }
          if(type==='adults'){ adults=val; adultsCount.textContent=val; }
          if(type==='children'){ children=val; childrenCount.textContent=val; }
        });
      });
      document.getElementById('btnSaveGuests').addEventListener('click', ()=>{
        hiddenRooms.value = rooms;
        hiddenAdults.value = adults;
        hiddenChildren.value = children;
        updateGuestBtn(); closeModal();
      });

      // --- Suggestion (popup) ---
      const input = document.getElementById('destination');
      const panel = document.getElementById('suggestPanel');
      let aborter = null;
      function showPanel(){ panel.hidden = false; }
      function hidePanel(){ panel.hidden = true; }
      function render(items){
        panel.innerHTML = '';
        if(!items.length){
          panel.innerHTML = `<div class="suggest-empty">No suggestions</div>`;
          return;
        }
        items.forEach(it=>{
          const div = document.createElement('div');
          div.className = 'suggest-item';
          div.innerHTML = `<span>${it.label}</span><span class="sub">${it.subtitle||''}</span>`;
          div.addEventListener('click', ()=>{
            input.value = it.label; hidePanel();
          });
          panel.appendChild(div);
        });
      }
      input.addEventListener('input', async ()=>{
        const q = input.value.trim();
        if(!q){ hidePanel(); return; }
        try{
          if(aborter) aborter.abort();
          aborter = new AbortController();
          const lang = 'en-us';
          const r = await fetch(`/api/suggest?q=${encodeURIComponent(q)}&lang=${lang}`,{signal:aborter.signal});
          const j = await r.json();
          render(j.items||[]);
          showPanel();
        }catch(e){}
      });
      input.addEventListener('focus', ()=>{
        if(input.value.trim()) showPanel();
      });
      document.addEventListener('click', (e)=>{
        if(!panel.contains(e.target) && e.target!==input){ hidePanel(); }
      });

      // --- Submit (prototype: no outbound) ---
      document.getElementById('mockForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        // ถ้าต้องการให้วิ่งไปหน้า search จริง ให้ uncomment บรรทัดล่าง:
        // location.href = `/search.html?q=${encodeURIComponent(input.value||'Bangkok')}&checkin=${inPicker.formatDate(inPicker.selectedDates[0],'Y-m-d')}&checkout=${outPicker.formatDate(outPicker.selectedDates[0],'Y-m-d')}&rooms=${rooms}&adults=${adults}&children=${children}`;
        alert('Prototype only: no outbound link.\nYou can enable redirect in the script.');
      });
    })();
  </script>
</body>
</html>
