<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Click & Go – เปรียบเทียบราคาโรงแรม จองง่ายในคลิกเดียว</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/style.css" />
  <!-- flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_green.css">
  <style>
    :root{
      --brand:#0ea5a0;
      --muted:#6b7280;
      --card:#ffffff;
      --ring:#0ea5a066;
    }
    /* ---------- layout basics ---------- */
    body{margin:0;background:#fafafa;color:#111;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    header.site-header{background:#fff;border-bottom:1px solid #eee}
    header .inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:#111}
    .brand img{display:block}
    .brand-text{font-weight:800}
    nav.main-nav{margin-left:auto;display:flex;gap:16px}
    nav.main-nav a{color:#111;text-decoration:none}
    /* ---------- hero ---------- */
    .hero{border-radius:16px;overflow:hidden}
    .hero img{width:100%;display:block}
    /* ---------- search box ---------- */
    .mock-wrap{ max-width:1030px; width:100%; margin:0 auto; }
    .mock-box{ width:100%; background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.08); padding:16px; display:flex; flex-direction:column; justify-content:center; }
    .mock-title{ margin:0 0 6px; font-weight:800; font-size:22px; }
    .mock-sub{ margin:0 0 12px; color:var(--muted); }

    /* ✅ บังคับ 2 คอลัมน์เสมอ และกันการ override ภายนอก */
    .mock-row{
      display:grid !important;
      grid-template-columns:minmax(0,1fr) minmax(0,1fr) !important;
      gap:10px; align-items:center;
    }
    .full-row{ grid-column:1 / -1; }

    .mock-input,.guest-input,.mock-btn{ height:44px; border:1px solid #d7d7d7; border-radius:8px; padding:0 12px; background:#fff; font-size:15px }
    .mock-input{ width:100% }
    .guest-input{ text-align:left; cursor:pointer }
    .mock-btn{ background:var(--brand); color:#fff; border:0; cursor:pointer; font-weight:700; white-space:nowrap }
    .mock-btn:focus{ outline:3px solid var(--ring); outline-offset:2px }
    .mock-btn:active{ transform:translateY(1px) }
    .btn-wide{ width:100% }

    .field{ position:relative }
    .field-label{ position:absolute; left:12px; top:6px; font-size:12px; color:#6b7280; pointer-events:none }
    .has-label .mock-input,.has-label .flatpickr-input{ height:56px; padding-top:18px }

    /* Suggestion */
    .suggest-wrap{ position:relative }
    .suggest-panel{ position:absolute; left:0; right:0; top:calc(100% + 4px); background:#fff; border:1px solid #ddd; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,.08); max-height:260px; overflow:auto; z-index:9999; display:none }
    .suggest-group{ padding:8px 12px; font-weight:700; color:#6b7280; background:#fafafa; border-top:1px solid #f3f4f6 }
    .suggest-item{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px 12px; cursor:pointer }
    .suggest-item:hover{ background:#f6f6f6 }
    .s-label{ font-weight:600 } .s-sub{ color:#777; font-size:13px }

    /* Guest modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:999 }
    .modal{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:#fff; border-radius:12px; width:min(92vw,420px); box-shadow:0 12px 24px rgba(0,0,0,.2); z-index:1000; display:none }
    .modal-header,.modal-footer{ padding:14px 16px } .modal-header{ border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center }
    .modal-title{ font-weight:700; font-size:18px } .modal-body{ padding:10px 16px 0 16px }
    .row-ctrl{ display:flex; align-items:center; justify-content:space-between; padding:10px 0 } .row-ctrl + .row-ctrl{ border-top:1px dashed #eee }
    .label-wrap{ display:flex; flex-direction:column; gap:2px } .label-wrap small{ color:#666 }
    .counter{ display:flex; align-items:center; gap:10px } .btn-ctrl{ width:36px; height:36px; border-radius:50%; border:1px solid #ccc; background:#fff; font-size:18px; cursor:pointer }
    .count{ min-width:20px; text-align:center; font-weight:700 }
    .btn-outline{ border:1px solid #bbb; background:#fff; color:#333; border-radius:8px; padding:8px 14px } .btn-primary{ border:0; background:var(--brand); color:#fff; border-radius:8px; padding:8px 14px }

    /* Popular grid (เหมือนเดิม) */
    .popular{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    @media(min-width:860px){.popular{grid-template-columns:repeat(4,1fr)}}
    .card{background:#fff;border-radius:12px;overflow:hidden;border:1px solid #eee}
    .card img{width:100%;aspect-ratio:16/11;object-fit:cover;display:block}
    .card .cap{position:absolute;left:10px;bottom:10px;background:rgba(0,0,0,.5);color:#fff;padding:6px 10px;border-radius:999px;font-weight:700}
    .cap-wrap{position:relative}
  </style>
</head>
<body>
<header class="site-header" role="banner">
  <div class="inner">
    <a class="brand" href="/index.html" aria-label="หน้าแรก Click & Go">
      <img src="/logo.png" width="40" height="40" alt="">
      <span class="brand-text">Click & Go</span>
    </a>
    <nav class="main-nav" aria-label="เมนูหลัก">
      <a href="/index.html">หน้าแรก</a>
      <a href="/deals.html">โปรโมชั่น</a>
    </nav>
  </div>
</header>

<main class="container">
  <!-- hero -->
  <div class="hero" aria-hidden="true">
    <img src="/hero.jpg" alt="">
  </div>

  <!-- SEARCH BOX -->
  <section style="margin:24px 0">
    <h2 class="section-title">ค้นหาโรงแรม</h2>
    <div class="mock-wrap"><div class="mock-box">
      <h3 class="mock-title">ค้นหาดีลที่ใช่สำหรับคุณ</h3>
      <p class="mock-sub">พิมพ์ชื่อเมือง เลือกวันที่ ระบุผู้เข้าพัก หรือไปที่โหมดค้นชื่อโรงแรม</p>

      <form id="cgForm" class="mock-row" method="GET" action="/search.html" autocomplete="off">
        <!-- แถว 1: เมือง + ปุ่มโหมดโรงแรม -->
        <div class="suggest-wrap">
          <!-- ✅ placeholder สั้นลง -->
          <input type="text" id="dest" name="q" class="mock-input" placeholder="พิมพ์ชื่อเมือง" aria-label="ปลายทาง">
          <div id="suggestPanel" class="suggest-panel" role="listbox" aria-label="คำแนะนำ"></div>
        </div>
        <button type="button" id="btnHotelMode" class="mock-btn" aria-label="ไปค้นหาจากชื่อโรงแรม">ค้นชื่อโรงแรม</button>

        <!-- แถว 2: เช็คอิน + เช็คเอาท์ -->
        <div class="field has-label">
          <span class="field-label">เช็คอิน</span>
          <input type="text" id="ci" name="checkin" class="mock-input" readonly>
        </div>
        <div class="field has-label">
          <span class="field-label">เช็คเอาท์</span>
          <input type="text" id="co" name="checkout" class="mock-input" readonly>
        </div>

        <!-- แถว 3: ผู้เข้าพัก -->
        <button type="button" id="guestBtn" class="guest-input full-row">1 ห้อง, 2 ผู้ใหญ่, 0 เด็ก</button>

        <!-- แถว 4: ปุ่มค้นหา -->
        <button type="submit" class="mock-btn btn-wide full-row">ค้นหา</button>

        <!-- hidden -->
        <input type="hidden" id="rooms"    name="rooms"    value="1">
        <input type="hidden" id="adults"   name="adults"   value="2">
        <input type="hidden" id="children" name="children" value="0">
        <input type="hidden"               name="lang"     value="th-th">
        <input type="hidden" id="cityId"   name="cityId"   value="">
        <input type="hidden" id="hotelId"  name="hotelId"  value="">
      </form>
    </div></div>
  </section>

  <!-- POPULAR (ตัวอย่างเดิม) -->
  <section>
    <h3 class="section-title">ปลายทางยอดนิยมในไทย</h3>
    <div class="popular">
      <a class="card" href="/search.html?q=กรุงเทพ&checkin=&checkout=">
        <div class="cap-wrap"><img src="/dest/bkk.jpg" alt="กรุงเทพฯ"><span class="cap">กรุงเทพฯ</span></div>
      </a>
      <a class="card" href="/search.html?q=เชียงใหม่&checkin=&checkout=">
        <div class="cap-wrap"><img src="/dest/cnx.jpg" alt="เชียงใหม่"><span class="cap">เชียงใหม่</span></div>
      </a>
      <a class="card" href="/search.html?q=ภูเก็ต&checkin=&checkout=">
        <div class="cap-wrap"><img src="/dest/hkt.jpg" alt="ภูเก็ต"><span class="cap">ภูเก็ต</span></div>
      </a>
      <a class="card" href="/search.html?q=พัทยา&checkin=&checkout=">
        <div class="cap-wrap"><img src="/dest/pty.jpg" alt="พัทยา"><span class="cap">พัทยา</span></div>
      </a>
    </div>
  </section>
</main>

<!-- Guest modal -->
<div id="backdrop" class="modal-backdrop" aria-hidden="true"></div>
<div id="guestModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="guestTitle">
  <div class="modal-header">
    <div id="guestTitle" class="modal-title">ผู้เข้าพัก</div>
    <button class="btn-outline" type="button" id="btnCloseGuest">ปิด</button>
  </div>
  <div class="modal-body">
    <div class="row-ctrl">
      <div class="label-wrap"><strong>ห้อง</strong><small>1–10</small></div>
      <div class="counter"><button class="btn-ctrl" data-t="rooms" data-op="-">−</button><span id="vRooms" class="count">1</span><button class="btn-ctrl" data-t="rooms" data-op="+">+</button></div>
    </div>
    <div class="row-ctrl">
      <div class="label-wrap"><strong>ผู้ใหญ่</strong><small>1–10</small></div>
      <div class="counter"><button class="btn-ctrl" data-t="adults" data-op="-">−</button><span id="vAdults" class="count">2</span><button class="btn-ctrl" data-t="adults" data-op="+">+</button></div>
    </div>
    <div class="row-ctrl">
      <div class="label-wrap"><strong>เด็ก</strong><small>0–10</small></div>
      <div class="counter"><button class="btn-ctrl" data-t="children" data-op="-">−</button><span id="vChildren" class="count">0</span><button class="btn-ctrl" data-t="children" data-op="+">+</button></div>
    </div>
  </div>
  <div class="modal-footer" style="display:flex;justify-content:flex-end;gap:8px">
    <button class="btn-outline" type="button" id="btnGuestCancel">ยกเลิก</button>
    <button class="btn-primary" type="button" id="btnGuestOk">ตกลง</button>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
<script>
(function(){
  const $ = s => document.querySelector(s);
  const panel = $('#suggestPanel');
  const dest  = $('#dest');

  /* ---------- Date pickers ---------- */
  const ONE = 86400000;
  const today = new Date();
  const fmtISO = d => d.toISOString().slice(0,10);
  const ci = flatpickr("#ci", {
    locale: "th",
    dateFormat: "d/m/Y",
    defaultDate: today,
    minDate: today,
    onChange: (sel)=> {
      const base = sel?.[0] || new Date();
      const minCo = new Date(base.getTime()+ONE);
      co.set('minDate', minCo);
      if(!co.selectedDates.length || co.selectedDates[0] <= minCo){ co.setDate(minCo, true); }
    }
  });
  const co = flatpickr("#co", {
    locale: "th",
    dateFormat: "d/m/Y",
    defaultDate: new Date(Date.now()+ONE),
    minDate: new Date(Date.now()+ONE)
  });

  /* ---------- Guest modal ---------- */
  const modal = $('#guestModal'), backdrop = $('#backdrop');
  const openM = ()=>{ modal.style.display='block'; backdrop.style.display='block'; };
  const closeM = ()=>{ modal.style.display='none'; backdrop.style.display='none'; };
  $('#guestBtn').addEventListener('click', openM);
  $('#btnCloseGuest').addEventListener('click', closeM);
  $('#btnGuestCancel').addEventListener('click', closeM);

  const syncGuestBtn = ()=>{
    $('#guestBtn').textContent = `${$('#rooms').value} ห้อง, ${$('#adults').value} ผู้ใหญ่, ${$('#children').value} เด็ก`;
    $('#vRooms').textContent = $('#rooms').value;
    $('#vAdults').textContent = $('#adults').value;
    $('#vChildren').textContent = $('#children').value;
  };
  syncGuestBtn();

  document.querySelectorAll('.btn-ctrl').forEach(b=>{
    b.addEventListener('click', ()=>{
      const t=b.dataset.t, op=b.dataset.op;
      const limits={rooms:[1,10],adults:[1,10],children:[0,10]}[t];
      const hid = $('#'+t);
      let v = +hid.value;
      v = op==='+' ? Math.min(limits[1], v+1) : Math.max(limits[0], v-1);
      hid.value = String(v);
      syncGuestBtn();
    });
  });
  $('#btnGuestOk').addEventListener('click', ()=>{ syncGuestBtn(); closeM(); });

  /* ---------- Suggest (เมือง) ---------- */
  let aborter=null;
  const showPanel = html => { panel.innerHTML = html; panel.style.display = 'block'; };
  const hidePanel = () => { panel.style.display='none'; };
  dest.addEventListener('input', async ()=>{
    const q = dest.value.trim();
    if(!q){ hidePanel(); return; }
    try{
      aborter?.abort(); aborter = new AbortController();
      const res = await fetch(`/api/suggest?q=${encodeURIComponent(q)}&lang=th-th&type=city`, {signal: aborter.signal});
      const data = await res.json().catch(()=>({ok:false,items:[]}));
      if(!data.ok || !Array.isArray(data.items)){ hidePanel(); return; }
      const cityItems = data.items.slice(0,30).map(it=>`
        <div class="suggest-item" role="option" data-id="${it.city_id||it.value||it.id||''}" data-label="${(it.label||it.city_name||'').replace(/"/g,'&quot;')}">
          <div>
            <div class="s-label">${it.label||it.city_name||'-'}</div>
            <div class="s-sub">${it.country||''}</div>
          </div>
          <div class="s-sub">เลือก</div>
        </div>`).join('');
      showPanel(`<div class="suggest-group">เมือง</div>${cityItems}`);
      panel.querySelectorAll('.suggest-item').forEach(el=>{
        el.addEventListener('click', ()=>{
          dest.value = el.dataset.label || '';
          $('#cityId').value = el.dataset.id || '';
          hidePanel();
        });
      });
    }catch(_){ /* ignore */ }
  });
  document.addEventListener('click', (e)=>{ if(!panel.contains(e.target) && e.target!==dest) hidePanel(); });

  /* ---------- ปุ่มโหมดค้นชื่อโรงแรม ---------- */
  function goHotelPage(){
    // ส่งต่อพารามิเตอร์ที่จำเป็น
    const qp = new URLSearchParams({
      q: dest.value.trim(),
      checkin: ci.input.value,
      checkout: co.input.value,
      rooms: $('#rooms').value,
      adults: $('#adults').value,
      children: $('#children').value,
      lang: 'th-th'
    });
    // หากเจอ cityId จาก suggest ก็แนบไปด้วย (ไม่บังคับ)
    if($('#cityId').value) qp.set('cityId',$('#cityId').value);
    location.href = `/search-hotel.html?${qp.toString()}`;
  }
  $('#btnHotelMode').addEventListener('click', goHotelPage);

  /* ---------- on submit: ถ้ามี cityId จะเด่นกว่าคำ q ---------- */
  $('#cgForm').addEventListener('submit', (e)=>{
    // ปรับวันที่เป็นรูปแบบ YYYY-MM-DD ให้ฝั่ง search ใช้งาน (ถ้า search.html ต้องการแบบนี้)
    const toISO = (s)=>{
      const [d,m,y] = String(s||'').split('/');
      if(!d||!m||!y) return '';
      return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
    };
    const q = new URLSearchParams(location.search);
    // เขียน hidden ที่แปลงแล้ว
    const ciISO = toISO(ci.input.value);
    const coISO = toISO(co.input.value);
    if(ciISO) $('#ci').value = ciISO;
    if(coISO) $('#co').value = coISO;
    // ถ้ามี cityId ให้คงไว้ในฟอร์ม (ชื่อฟิลด์มีอยู่แล้ว)
  });
})();
</script>
</body>
</html>
