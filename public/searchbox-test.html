<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agoda Search Box – Test | Click & Go</title>
  <meta name="description" content="Standalone test page for Agoda Sherpa search box (TH/EN) with exact box size and full functionality." />
  <link rel="icon" href="favicon.ico" />

  <style>
    :root{
      --brand:#0ea5a0;
      --bg:#f7f7f8;
      --card:#fff;
      --text:#222;
      --muted:#666;
      --border:#e5e7eb;
      --shadow: 0 6px 18px rgba(0,0,0,.08);
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:var(--bg); }

    .header{
      position:sticky; top:0; z-index:10;
      background:#fff; border-bottom:1px solid var(--border);
    }
    .header .inner{
      max-width:1200px; margin:0 auto; padding:10px 16px;
      display:flex; align-items:center; gap:14px; justify-content:space-between;
    }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:#111; }
    .brand img{ width:36px; height:36px; }
    .brand .tt{ font-weight:800; letter-spacing:.2px; }
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border); background:#fff; color:#111;
      height:36px; padding:0 12px; border-radius:8px; cursor:pointer;
    }
    .btn.primary{ background:var(--brand); border-color:var(--brand); color:#fff; }
    .btn:active{ transform: translateY(1px); }

    .container{ max-width:1200px; margin: 20px auto; padding: 0 16px; }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:12px;
      padding:16px; box-shadow:var(--shadow);
    }
    .title{ margin:0 0 10px; font-size: 24px; }
    .muted{ color:var(--muted); margin:2px 0 12px; }

    /* Wrap ของ Agoda widget: ความกว้างสูงสุด 1030px ตามสเปค Agoda */
    .agoda-wrap{
      max-width:1030px; width:100%;
      margin: 0 auto;                  /* จัดกึ่งกลาง */
      overflow: hidden;                 /* กัน scroll แนวนอน */
    }

    /* บริเวณปุ่มสลับภาษา */
    .toolbar{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .lang-indicator{ font-size:14px; color:var(--muted); }

    /* หมายเหตุ/ทดสอบ */
    .help{
      margin-top:14px; font-size:14px; color:#444; background:#fafafa;
      border:1px dashed var(--border); border-radius:10px; padding:12px;
    }
    code{ background:#f0f2f5; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <!-- simple header -->
  <div class="header">
    <div class="inner">
      <a class="brand" href="/">
        <img src="logo.png" alt="Click & Go">
        <div class="tt">Click & Go – Agoda Search Box Test</div>
      </a>

      <div class="toolbar">
        <button class="btn" id="btnTH">ภาษาไทย (th-th)</button>
        <button class="btn" id="btnEN">English (en-us)</button>
        <span class="lang-indicator" id="langLabel">Current: en-us</span>
      </div>
    </div>
  </div>

  <main class="container">
    <div class="card">
      <h1 class="title">Agoda Search Box</h1>
      <p class="muted">กล่องค้นหาของ Agoda (Sherpa) แยกเป็นหน้า Test เพื่อปรับแต่งก่อนนำไปใช้จริง</p>

      <!-- กล่องสำหรับใส่ Agoda widget -->
      <div class="agoda-wrap">
        <!-- สำคัญ: id ด้านล่างต้องตรงกับ stg.id -->
        <div id="adgshp-test-1"></div>
      </div>

      <div class="help">
        <strong>หมายเหตุ:</strong>
        <ul>
          <li>กล่องนี้จำกัดความกว้างสูงสุดไว้ที่ <code>1030px</code> (ตามสเปคเดิมของ Agoda) และทำให้ responsive โดยใช้ <code>width:100%</code></li>
          <li>ใช้สคริปต์ของ Agoda: <code>//cdn0.agoda.net/images/sherpa/js/sherpa_init1_08.min.js</code></li>
          <li>ปุ่มด้านบนสามารถ <em>สลับภาษา TH/EN</em> ได้ทันที (จะ re-init widget)</li>
        </ul>
      </div>
    </div>
  </main>

  <!-- โหลดสคริปต์ Agoda (โหลดครั้งเดียว) -->
  <script src="//cdn0.agoda.net/images/sherpa/js/sherpa_init1_08.min.js"></script>
  <script>
    // ====== ตั้งค่าเริ่มต้น ======
    const AGODA_DIV_ID = 'adgshp-test-1';  // ต้องตรงกับ <div id="...">
    let currentLang = 'en-us';             // ค่าเริ่มต้น

    // ฟังก์ชันสร้าง widget ใหม่ (ทำลายของเดิมโดยการล้าง DOM แล้ว initialize ใหม่)
    function renderAgodaBox(lang = 'en-us') {
      try {
        // ล้าง element เดิมเพื่อกันปัญหาซ้อน
        const host = document.getElementById(AGODA_DIV_ID);
        if (!host) return;
        host.innerHTML = '';

        // ตั้งค่าตามสเปค Agoda
        var stg = {};
        stg.crt = "8131380105591";   // account/widget hash ของคุณ
        stg.version = "1.04";
        stg.id = stg.name = AGODA_DIV_ID;

        // *** กำหนดขนาดตามสเปคเดิมของ Agoda ***
        // ใช้ width 100% + ครอบด้วย .agoda-wrap (max-width:1030px) -> กัน scroll และยังคงสัดส่วนเดิม
        stg.width = "100%";
        stg.height = "293px";

        stg.ReferenceKey = "kTXcoy+P0WUNEGEcPWXr0A==";
        stg.Layout = "Oneline";
        stg.Language = lang;         // "en-us" หรือ "th-th"
        stg.Cid = "1949420";
        stg.DestinationName = "";
        stg.OverideConf = false;

        new AgdSherpa(stg).initialize();

        // อัปเดต label
        currentLang = lang;
        document.getElementById('langLabel').textContent = 'Current: ' + currentLang;
      } catch(err) {
        console.error('Agoda init error:', err);
      }
    }

    // ปุ่มสลับภาษา
    document.getElementById('btnTH').addEventListener('click', () => renderAgodaBox('th-th'));
    document.getElementById('btnEN').addEventListener('click', () => renderAgodaBox('en-us'));

    // เริ่มต้น: ภาษา EN
    renderAgodaBox(currentLang);
  </script>
</body>
</html>
