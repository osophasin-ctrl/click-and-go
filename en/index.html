<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Click & Go — Find great hotel deals</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/style.css">
  <style>
    :root{--brand:#0aa297;--muted:#666}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    header .inner{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .brand-text{font-weight:800;font-size:20px;color:#111}
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:20px;align-items:center}
    @media(max-width:900px){.hero{grid-template-columns:1fr}}
    h1{font-size:40px;line-height:1.2;margin:12px 0 10px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px;box-shadow:0 4px 16px rgba(0,0,0,.06)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .inp,.btn{height:44px;border:1px solid #d7d7d7;border-radius:10px;padding:0 12px;font-size:14px}
    .btn{background:var(--brand);color:#fff;border:0;font-weight:800;cursor:pointer}
    .row{display:flex;gap:12px;align-items:center}
    .row.wrap{flex-wrap:wrap}
    .grow{flex:1}
    .suggest{position:absolute;z-index:20;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin-top:4px;max-height:260px;overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .suggest button{display:block;width:100%;text-align:left;padding:10px 12px;border:0;background:#fff;cursor:pointer}
    .suggest button:hover{background:#f3fbfa}
    .tag{display:inline-block;background:#ecfeff;border:1px solid #cffafe;color:#036672;padding:4px 8px;border-radius:999px;font-size:12px;margin-right:6px}
    .muted{color:#666}
  </style>
</head>
<body>
<header>
  <div class="inner container">
    <a class="brand" href="/en/index.html"><img src="/logo.png" alt="Click & Go" width="40" height="40"><span class="brand-text">Click & Go</span></a>
    <nav><a href="/index.html">ไทย</a></nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <div>
      <h1>Find stays, fast.</h1>
      <p class="muted">Type a city or hotel, pick dates and guests, then search. We’ll show up to 30 results; you can jump to our partner for more.</p>
      <div class="card" style="margin-top:14px">
        <form id="searchForm" action="/en/search.html">
          <input type="hidden" name="lang" value="en-us">
          <div class="field" style="position:relative">
            <label for="q">Destination / Hotel</label>
            <input id="q" class="inp" name="q" type="text" placeholder="e.g., Bangkok, Chiang Mai, or hotel name" autocomplete="off">
            <div id="sug" class="suggest" style="display:none"></div>
            <div class="muted" style="font-size:13px">Tip: pick an item from the list; we support both City ID and hotel name.</div>
          </div>
          <div class="grid" style="margin-top:10px">
            <div class="field"><label for="ci">Check-in</label><input id="ci" class="inp" name="checkin" type="date"></div>
            <div class="field"><label for="co">Check-out</label><input id="co" class="inp" name="checkout" type="date"></div>
          </div>
          <div class="row wrap" style="margin-top:10px">
            <div class="field grow"><label for="adults">Adults</label><input id="adults" class="inp" name="adults" type="number" min="1" max="10" value="2"></div>
            <div class="field grow"><label for="children">Children</label><input id="children" class="inp" name="children" type="number" min="0" max="10" value="0"></div>
            <div class="field grow"><label for="rooms">Rooms</label><input id="rooms" class="inp" name="rooms" type="number" min="1" max="10" value="1"></div>
          </div>
          <div class="row" style="margin-top:12px;justify-content:flex-end">
            <button class="btn" type="submit">Search</button>
          </div>
        </form>
      </div>
      <div style="margin-top:10px">
        <span class="tag">City ID (EN/TH)</span>
        <span class="tag">Hotel autocomplete</span>
        <span class="tag">Affiliate-ready</span>
      </div>
    </div>
    <div>
      <img src="/hero.jpg" alt="Hotels" style="width:100%;border-radius:16px;border:1px solid #e5e7eb">
    </div>
  </section>
</main>

<script>
(function(){
  const $ = s => document.querySelector(s);
  const sug = $('#sug'), q = $('#q');
  const ONE = 86400000, iso = d => new Date(d).toISOString().slice(0,10);
  const ci=$('#ci'), co=$('#co');
  const tCi=new Date(), tCo=new Date(Date.now()+ONE);
  ci.value=iso(tCi); co.value=iso(tCo);
  ci.min=iso(new Date()); co.min=iso(new Date(tCi.getTime()+ONE));
  ci.addEventListener('change',()=>{const a=new Date(ci.value),n=new Date(a.getTime()+ONE); if(!co.value||new Date(co.value)<=a) co.value=iso(n); co.min=iso(n); });

  async function fetchJson(u){ try{const r=await fetch(u,{cache:'no-store'}); return await r.json(); }catch(_){ return {ok:false}; } }

  let last = '';
  async function suggest(val){
    const qv=String(val||'').trim(); if(!qv){sug.style.display='none';sug.innerHTML='';return;}
    last=qv;

    // city EN
    const cu=new URL('/api/city-suggest', location.origin);
    cu.searchParams.set('q', qv); cu.searchParams.set('lang', 'en-us'); cu.searchParams.set('limit','8');
    const c=await fetchJson(cu.toString());

    // hotel EN index
    const hu=new URL('/api/hotel-search', location.origin);
    hu.searchParams.set('q', qv); hu.searchParams.set('lang','en-us'); hu.searchParams.set('limit','8');
    const h=await fetchJson(hu.toString());

    if(qv!==last) return;
    const cities=(c&&c.ok?c.items:[]).map(it=>({t:'city',label:it.label,id:it.city_id}));
    const hotels=(h&&h.ok?h.items:[]).map(it=>({t:'hotel',label:it.label,id:it.hotel_id}));
    const items=[...cities,...hotels].slice(0,12);
    if(!items.length){sug.style.display='none';sug.innerHTML='';return;}

    sug.innerHTML = items.map(it=>{
      const note = it.t==='city'?'City':'Hotel';
      return `<button type="button" data-t="${it.t}" data-id="${it.id}" data-label="${it.label}">${it.label}<br><small style="color:#666">${note}</small></button>`;
    }).join('');
    sug.style.display='block';
    sug.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click',()=>{
        const t=b.dataset.t, id=b.dataset.id, label=b.dataset.label;
        q.value=label;
        const f=document.getElementById('searchForm');
        if(t==='city'){ f.insertAdjacentHTML('beforeend', `<input type="hidden" name="cityId" value="${id}">`); }
        else{ f.insertAdjacentHTML('beforeend', `<input type="hidden" name="hid" value="${id}">`); }
        f.submit();
      });
    });
  }
  q.addEventListener('input',e=>suggest(e.target.value));
  q.addEventListener('focus',e=>suggest(e.target.value));
  document.addEventListener('click', e=>{ if(!sug.contains(e.target)&&e.target!==q){sug.style.display='none';} });
})();
</script>
</body>
</html>
