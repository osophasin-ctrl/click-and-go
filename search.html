<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ผลการค้นหาโรงแรม | Click & Go</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header class="site-header">
  <div class="inner">
    <a href="index.html" class="brand">
      <img src="logo.png" alt="Click & Go" width="40" height="40">
      <span class="brand-text">Click & Go</span>
    </a>
    <nav class="main-nav">
      <a href="index.html">หน้าแรก</a>
      <a href="deals.html">โปรโมชั่น</a>
    </nav>
  </div>
</header>

<main class="container">
  <h1 class="section-title">ผลการค้นหาโรงแรม</h1>

  <!-- Search summary -->
  <p id="search-summary" class="muted"></p>

  <!-- Search results grid -->
  <div id="results" class="hotel-grid" style="margin-top: 16px;"></div>
</main>

<footer class="site-footer">
  <div class="container" style="text-align:center">
    <div class="footer-links">
      <a href="privacy.html">Privacy</a> ·
      <a href="terms.html">Terms</a> ·
      <a href="about.html">About</a>
    </div>
  </div>
</footer>

<script>
(async function() {
  const params = new URLSearchParams(location.search);
  const q        = params.get('q') || 'Bangkok';
  const checkin  = params.get('checkin') || '';
  const checkout = params.get('checkout') || '';
  const rooms    = params.get('rooms') || '1';
  const adults   = params.get('adults') || '2';
  const children = params.get('children') || '0';

  document.getElementById('search-summary').textContent =
    `${q} | วันที่: ${checkin} → ${checkout} | ผู้เข้าพัก: ${adults} ผู้ใหญ่, ${rooms} ห้อง`;

  try {
    const res = await fetch(`/api/search?q=${encodeURIComponent(q)}&checkin=${encodeURIComponent(checkin)}&checkout=${encodeURIComponent(checkout)}&rooms=${rooms}&adults=${adults}&children=${children}&lang=th-th`);
    const data = await res.json();

    const container = document.getElementById('results');
    if (!data.ok || !data.items || !data.items.length) {
      container.innerHTML = '<p>ไม่พบโรงแรมที่ตรงกับคำค้นหา</p>';
      return;
    }

    container.innerHTML = data.items.map(item => `
      <div class="hotel-card">
        <img src="${item.imageUrl}" alt="${item.name}" loading="lazy">
        <h3>${item.name}</h3>
        <p>${item.city}</p>
        <p><strong>${item.priceFrom} ${item.currency}</strong></p>
        ${item.freeCancellation ? '<span class="badge success">Free cancellation</span>' : ''}
        ${item.mealPlan ? `<span class="badge">${item.mealPlan}</span>` : ''}
        <a href="${item.deeplink}" target="_blank" class="btn">ดูดีล</a>
      </div>
    `).join('');
  } catch (e) {
    console.error('Search error', e);
    document.getElementById('results').innerHTML = '<p>เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
  }
})();
</script>

<style>
.hotel-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
}
.hotel-card {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.hotel-card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 8px;
}
.badge {
  display: inline-block;
  font-size: 0.8rem;
  color: #fff;
  background: #777;
  padding: 2px 6px;
  border-radius: 6px;
  margin-right: 4px;
}
.badge.success { background: #2ecc71; }
.btn {
  display: inline-block;
  margin-top: 8px;
  background: #00a651;
  color: #fff;
  padding: 6px 12px;
  border-radius: 6px;
  text-decoration: none;
}
</style>

</body>
</html>
